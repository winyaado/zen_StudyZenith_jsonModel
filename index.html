<!DOCTYPE html>
<!--
  初学者向けガイド（index.html）
  ------------------------------------------------------------
  このページはメイン画面です。以下の構成になっています。
  - ヘッダー: タイトルと注意書き
  - タブナビゲーション: 各機能（講義選択/履修中/要件チェック/データ管理/要件管理/共有）へ切替
  - 各タブのコンテンツ: id=... と .tab-content で対応（tabs.js が表示/非表示を制御）
  - スクリプト: tailwind（CDN）, Google Fonts, アプリ本体の CSS/JS

  使い方の流れ（例）
  1) 講義選択タブで検索/フィルタ → 履修追加
  2) 履修中タブで確認・削除
  3) 卒業要件チェックで達成状況を確認
  4) データ管理で科目コードをエクスポート/インポート
  5) 卒業要件管理で JSON 要件を入出力
  6) 共有タブで閲覧専用リンクを生成（share.html に遷移）
-->
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>学習管理ページ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body class="p-4 md:p-8">
  <div class="container mx-auto max-w-6xl">
    <header class="mb-8 text-center">
      <h1 class="text-4xl font-bold text-gray-800">学習管理ページ</h1>
      <p class="text-gray-600 mt-2">履修状況を確認し、卒業要件をチェックしましょう。</p>
      <p class="text-gray-600 mt-2">情報の正確性は保証しないので学生便覧等で最終確認を忘れずに！</p>
    </header>

        <!-- タブの見出し（tabs.js が制御） -->
        <div class="mb-6 border-b border-gray-300">
          <nav class="flex flex-wrap" aria-label="Tabs">
            <button class="tab-button active" data-tab="courseSelectionTab">講義選択</button>
            <button class="tab-button" data-tab="myCoursesTab">履修中講義</button>
            <button class="tab-button" data-tab="graduationCheckTab">卒業要件チェック</button>
            <button class="tab-button" data-tab="dataManagementTab">データ管理</button>
            <button class="tab-button" data-tab="gradReqManagementTab">卒業要件管理</button>
            <button class="tab-button" data-tab="shareTab">共有</button>
          </nav>
        </div>

        <!-- 講義選択タブ: 検索/フィルタから講義を選び、履修追加ボタンで右タブへ -->
        <div id="courseSelectionTab" class="tab-content">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">講義を検索・選択</h2>
            <p class="text-sm text-gray-600 mb-3">検索・カテゴリ（日本語表示）・クオーター（Q1〜Q4）で講義を絞り込み、「履修追加」で右タブに追加できます。</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
              <div class="md:col-span-1">
                <input type="text" id="searchInput" placeholder="講義名、科目コードなどで検索..."
                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>
          <div class="md:col-span-1">
            <select id="prefixFilter" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-white">
              <option value="">すべてのカテゴリ</option>
            </select>
          </div>
          <div class="md:col-span-1">
            <select id="quarterFilter" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-white">
              <option value="">すべてのクオーター</option>
            </select>
          </div>
        </div>
        <div id="allCourses" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 max-h-96 overflow-y-auto p-2">
          <p id="loadingMessage" class="text-gray-500 col-span-full text-center">講義データを読み込み中...</p>
        </div>
      </div>
    </div>

        <!-- 履修中タブ: 追加済みの講義を管理（検索/フィルタ/削除） -->
        <div id="myCoursesTab" class="tab-content hidden">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">履修中の講義一覧</h2>
            <p class="text-sm text-gray-600 mb-3">左タブで追加した講義が表示されます。検索・カテゴリ・クオーターで絞り込み、不要なものは「削除」してください。</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
              <div class="md:col-span-1">
                <input type="text" id="searchInputSelected" placeholder="講義名、科目コードなどで検索..."
                       class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
              </div>
          <div class="md:col-span-1">
            <select id="prefixFilterSelected" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-white">
              <option value="">すべてのカテゴリ</option>
            </select>
          </div>
          <div class="md:col-span-1">
            <select id="quarterFilterSelected" class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-white">
              <option value="">すべてのクオーター</option>
            </select>
          </div>
        </div>
        <div id="selectedCoursesList" class="space-y-3">
          <p class="text-gray-500">まだ講義が選択されていません。</p>
        </div>
      </div>
    </div>

        <!-- 卒業要件チェック: requirements.js の定義に基づいて達成状況を可視化 -->
        <div id="graduationCheckTab" class="tab-content hidden">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">卒業要件達成状況</h2>
            <p class="text-sm text-gray-600 mb-3">上限のみの項目（例: 社会接続）はメーターを表示せず単位数のみを表示します。詳細要件は JSON 定義に従います。</p>
            <div id="graduationStatus" class="space-y-4"></div>
          </div>
        </div>

    <!-- データ管理: 科目コードのエクスポート/インポートで保存・復元 -->
    <div id="dataManagementTab" class="tab-content hidden">
      <div class="card">
        <h2 class="text-2xl font-semibold mb-4 text-gray-700">履修データ管理</h2>
        <div class="space-y-4">
          <div>
            <button id="exportDataButton"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
              履修科目コードをエクスポート
            </button>
            <p class="text-xs text-gray-500 mt-1">選択した講義の科目コードをテキストファイルでエクスポートします。</p>
          </div>
          <div>
            <label for="importDataInput" class="block text-sm font-medium text-gray-700 mb-1">履修科目コードをインポート:</label>
            <textarea id="importDataInput" rows="4"
              class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="ここに科目コードを改行区切りで貼り付け"></textarea>
            <button id="importDataButton"
              class="mt-2 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
              インポート実行
            </button>
            <p class="text-xs text-gray-500 mt-1">エクスポートした科目コードを貼り付けて履修状況を復元します。</p>
          </div>
        </div>
      </div>
    </div>

        <!-- 卒業要件管理: JSON 要件の入出力とデフォルトへリセット -->
        <div id="gradReqManagementTab" class="tab-content hidden">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">卒業要件データ管理</h2>
        <div class="space-y-6">
          <div>
            <button id="exportRequirementsButton"
              class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
              現在の卒業要件をエクスポート (JSON)
            </button>
            <p class="text-xs text-gray-500 mt-1">現在適用されている卒業要件をJSONファイルでエクスポートします。</p>
          </div>
          <div>
            <label for="importRequirementsInputFile" class="block text-sm font-medium text-gray-700 mb-1">卒業要件をインポート (JSON):</label>
            <input type="file" id="importRequirementsInputFile" accept=".json"
              class="w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer bg-gray-50 focus:outline-none file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
            <button id="importRequirementsButton"
              class="mt-3 w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
              インポート実行
            </button>
            <p class="text-xs text-gray-500 mt-1">JSON形式の卒業要件ファイルをアップロードして適用します。</p>
          </div>
          <div class="mt-6">
            <h3 class="text-lg font-medium text-gray-700 mb-2">現在適用中の卒業要件 (JSON)</h3>
            <textarea id="currentRequirementsTextarea" rows="15" readonly
              class="w-full p-3 border border-gray-300 rounded-md shadow-sm bg-gray-100 text-xs font-mono"
              placeholder="ここに現在適用中の卒業要件がJSON形式で表示されます..."></textarea>
          </div>
          <div>
            <button id="resetRequirementsButton"
              class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-md shadow-sm transition duration-150 ease-in-out">
              卒業要件をデフォルトにリセット
            </button>
            <p class="text-xs text-gray-500 mt-1">卒業要件を初期状態に戻します。</p>
          </div>
        </div>
      </div>
    </div>

        <!-- 共有: タイトル/コメント付きの共有URLを生成（閲覧は share.html） -->
        <div id="shareTab" class="tab-content hidden">
          <div class="card">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">共有リンクの作成</h2>
            <p class="text-sm text-gray-600 mb-3">現在の履修選択をリンクにまとめて共有できます。リンク先は閲覧専用ページ（編集不可）です。コメントは最大512文字、危険な文字は自動的に無害化されます。</p>
            <div class="space-y-4">
              <div>
                <label class="block text-sm text-gray-700 mb-1" for="shareTitleInput">共有タイトル（任意）</label>
                <input id="shareTitleInput" type="text" maxlength="80" class="w-full p-2 border border-gray-300 rounded-md" placeholder="例: 2年次前期の候補" />
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1" for="shareCommentInput">コメント（任意・最大512文字）</label>
                <textarea id="shareCommentInput" rows="4" class="w-full p-2 border border-gray-300 rounded-md" placeholder="共有したいメモなど"></textarea>
                <div class="text-xs text-gray-500 mt-1"><span id="shareCommentCount">0</span>/512</div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <button id="generateShareLinkButton" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-md">共有リンクを生成</button>
                <button id="copyShareLinkButton" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-4 rounded-md" disabled>リンクをコピー</button>
              </div>
              <div>
                <label class="block text-sm text-gray-700 mb-1">共有リンク</label>
                <input id="shareLinkOutput" type="text" readonly class="w-full p-2 border border-gray-300 rounded-md bg-gray-100" placeholder="ここに生成されたリンクが表示されます" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="messageModal" class="modal">
    <div class="modal-content">
      <span class="close-button" id="closeModalButton">&times;</span>
      <p id="modalMessageText" class="text-gray-700 whitespace-pre-wrap"></p>
    </div>
  </div>

  <script type="module" src="./js/main.js"></script>
</body>
</html>
